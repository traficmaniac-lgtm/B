# NC Pilot Multi‑Pair — обзор режима (RU)

## 1. Назначение режима

**NC Pilot Multi‑Pair** — концепция мультипарного контура управления сеточными и квази‑маркет‑нейтральными сценариями, рассчитанная на одновременную работу по набору торговых пар. Режим описывает:

- **Как** отбирать пары и назначать им роли (основная/хедж, ведущая/ведомая).
- **Как** распределять бюджет и риск между парами.
- **Как** синхронизировать действия между парами (заказы, ребаланс, stop‑сценарии).
- **Как** стабилизировать исполнение, не допуская каскадного риска.

Режим не является отдельным UI‑окном — это **проектное описание** для расширения текущей системы (NC MICRO / ALGO PILOT) на мультипарный контур.

## 2. Ключевые цели

1. **Устойчивость**: локальные проблемы одной пары не должны ломать весь контур.
2. **Согласованность**: у каждой пары — единая роль и ясные правила синхронизации.
3. **Контролируемый риск**: лимиты по экспозиции, волатильности и корреляции.
4. **Предсказуемость**: определённый порядок петлей, измеримые KPI, однозначный rollback.
5. **Прозрачность**: полная трассировка решений и состояний по каждой паре.

## 3. Концептуальная модель

### 3.1 Роли пар

- **Primary (ведущая)** — задаёт основное направление/сетку, определяет ритм рынка.
- **Secondary (ведомая)** — хеджирует риск или уравновешивает отклонения.
- **Support (поддержка)** — используется как ликвидная «прослойка» для добора/разгрузки.

### 3.2 Кластеры

Пары собираются в **кластеры**, где одна ведущая пара управляет 1–N ведомых. Кластер формирует **общее окно риска** (экспозиция, волатильность, глубина стакана).

### 3.3 Слои управления

- **Слой сигналов**: отбор и ранжирование пар.
- **Слой распределения**: баланс между кластерами.
- **Слой исполнения**: генерация ордеров и коррекция сеток.
- **Слой защиты**: гейты, kill‑switch, rollback.

## 4. Входные данные (inputs)

- **Маркет‑данные**: price ticks, book‑ticker, volatility window, spread, liquidity score.
- **Состояние**: текущая сетка, fill history, open orders, k‑метрики.
- **Профиль риска**: max exposure, max drawdown, max order count.
- **Связь пар**: correlation matrix, статические пары‑связки, allowed hedges.

## 5. Выходы (outputs)

- **План действий по парам**: build grid, rebalance, pause, cancel.
- **Сводный план по кластеру**: aggregate exposure, expected edge, guard flags.
- **Журналы решений**: причины пропуска (guard reject), причины входа (signal accept).

## 6. KPI и метрики

- **Per‑pair**: PnL, fill rate, average spread capture, stale refresh count.
- **Per‑cluster**: net exposure, hedge ratio, risk heatmap.
- **System‑level**: error rate, total open orders, latency of sync.

## 7. Конфигурационные параметры (пример)

- `max_pairs_active`: максимум активных пар.
- `cluster_size`: число пар в одном кластере.
- `min_liquidity_score`: минимальная ликвидность для участия.
- `max_correlation`: ограничение корреляции внутри кластера.
- `rebalance_interval_sec`: частота ребаланса.
- `kill_switch_drawdown_pct`: аварийное отключение при просадке.

## 8. Типовые сценарии

1. **Нормальный цикл**: выбор пар → построение сеток → мониторинг → лёгкий ребаланс.
2. **Скачок волатильности**: freeze, уменьшение ордеров, расширение шага.
3. **Плохая ликвидность**: деактивация пары, перераспределение бюджета.
4. **Дисбаланс экспозиции**: активируется 2‑leg rebalancing loop spread.

## 9. Ограничения и допущения

- Режим зависит от качества price feed и детекторов stale.
- Для корректного хеджа требуется минимально допустимая корреляция.
- Недостаток ликвидности на одной паре автоматически снижает общий лимит кластера.

## 10. Связь с существующей системой

- **NC MICRO** — используется как эталон по guard‑логике и dedup.
- **ALGO PILOT** — используется как основа для KPI и управляемого grid.
- **NetWorker / PriceFeedManager** — источники данных и асинхронных задач.

## 11. Глоссарий

- **Cluster** — группа пар с общими лимитами риска.
- **Hedge ratio** — доля объёма вторичной пары относительно ведущей.
- **Rebalance loop** — цикл выравнивания экспозиции между legs.
- **Loop spread** — спред между legs, использующийся как триггер ребаланса.

## 12. Не‑цели (out of scope)

- Полная HFT‑схема с микросекундной латентностью.
- Автоматическое управление капиталом на уровне портфеля без лимитов.
- Полная замена существующих single‑pair режимов.

## 13. Минимальные требования к данным

- Bid/ask с TTL < 2–3s.
- История волатильности минимум 60s.
- Доступ к orderbook depth (top‑N) для оценки ликвидности.

## 14. Критерии успешности (KPIs)

- Стабильный hedge ratio в пределах ±5% от target.
- Количество emergency‑rollback < 1% от ребалансов.
- Падение PnL при всплесках волатильности ≤ заранее заданного порога.

## 15. План поэтапного запуска

1. **Песочница**: dry‑run без реальных ордеров.
2. **Ограниченный пул**: 1–2 пары, строгие лимиты.
3. **Полный режим**: динамическое распределение бюджета и авто‑кластеризация.
